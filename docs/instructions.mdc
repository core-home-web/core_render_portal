# Core Home Render Portal

## Purpose

The Core Render Portal is an internal tool designed to streamline the management of 3D render projects. It provides a structured workflow for creating, organizing, and tracking render requests with detailed specifications for items, parts, and materials.

## Architecture

### Tech Stack
- **Frontend**: Next.js 14 with App Router, TypeScript, Tailwind CSS
- **UI Components**: shadcn/ui with Radix UI primitives
- **Forms**: React Hook Form with Zod validation
- **Database**: Supabase (PostgreSQL) with real-time capabilities
- **Storage**: Supabase Storage for file uploads
- **Testing**: Vitest with React Testing Library
- **Code Quality**: ESLint, Prettier, Husky pre-commit hooks

### Project Structure

**Branch: `nov-13-ui-revisions`**

```
.
â”œâ”€â”€ DEPLOYMENT.md
â”œâ”€â”€ ERROR LOGS AND SOLUTIONS
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ ambiguous-column-references.md
â”‚   â”œâ”€â”€ build-syntax-errors.md
â”‚   â”œâ”€â”€ collaborators-view-406-error.md
â”‚   â”œâ”€â”€ database-function-permissions.md
â”‚   â”œâ”€â”€ whiteboard-board-fetch-400-error.md
â”‚   â”œâ”€â”€ whiteboard-csp-violations.md
â”‚   â””â”€â”€ whiteboard-toolbar-not-visible.md
â”œâ”€â”€ README.md
â”œâ”€â”€ TEMPLATE FILES
â”‚   â”œâ”€â”€ free-responsive-webflow-project.webflow
â”‚   â”‚   â”œâ”€â”€ css
â”‚   â”‚   â”œâ”€â”€ dashboard.html
â”‚   â”‚   â”œâ”€â”€ images
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”œâ”€â”€ js
â”‚   â”‚   â”œâ”€â”€ login.html
â”‚   â”‚   â””â”€â”€ signup.html
â”‚   â””â”€â”€ project-status-dashboard.webflow
â”‚       â”œâ”€â”€ 401.html
â”‚       â”œâ”€â”€ css
â”‚       â”œâ”€â”€ dashboard.html
â”‚       â”œâ”€â”€ images
â”‚       â”œâ”€â”€ index.html
â”‚       â”œâ”€â”€ js
â”‚       â”œâ”€â”€ login.html
â”‚       â””â”€â”€ signup.html
â”œâ”€â”€ app
â”‚   â”œâ”€â”€ api
â”‚   â”‚   â”œâ”€â”€ notify-collaborators
â”‚   â”‚   â”œâ”€â”€ project
â”‚   â”‚   â”œâ”€â”€ request-access
â”‚   â”‚   â”œâ”€â”€ send-invitation
â”‚   â”‚   â””â”€â”€ upload
â”‚   â”œâ”€â”€ auth
â”‚   â”‚   â”œâ”€â”€ login
â”‚   â”‚   â””â”€â”€ signup
â”‚   â”œâ”€â”€ dashboard
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ globals.css
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx
â”‚   â”œâ”€â”€ progress
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ project
â”‚   â”‚   â”œâ”€â”€ [id]
â”‚   â”‚   â”œâ”€â”€ invite
â”‚   â”‚   â”œâ”€â”€ new
â”‚   â”‚   â””â”€â”€ success
â”‚   â”œâ”€â”€ projects
â”‚   â”‚   â”œâ”€â”€ page-old-backup.tsx
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ settings
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ styleguide
â”‚       â”œâ”€â”€ README.md
â”‚       â””â”€â”€ page.tsx
â”œâ”€â”€ components
â”‚   â”œâ”€â”€ auth
â”‚   â”‚   â”œâ”€â”€ login-form.tsx
â”‚   â”‚   â””â”€â”€ signup-form.tsx
â”‚   â”œâ”€â”€ image-annotation
â”‚   â”‚   â”œâ”€â”€ AnnotationWorkspace.tsx
â”‚   â”‚   â”œâ”€â”€ BulkPartEditor.tsx
â”‚   â”‚   â”œâ”€â”€ FileUpload.tsx
â”‚   â”‚   â”œâ”€â”€ ImageCanvas.tsx
â”‚   â”‚   â”œâ”€â”€ ImageTabs.tsx
â”‚   â”‚   â”œâ”€â”€ PartDetailsPanel.tsx
â”‚   â”‚   â”œâ”€â”€ PartTemplates.tsx
â”‚   â”‚   â”œâ”€â”€ UnifiedImageViewport.tsx
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â”œâ”€â”€ upload-types.ts
â”‚   â”‚   â”œâ”€â”€ useFileUpload.ts
â”‚   â”‚   â”œâ”€â”€ useImageCanvas.ts
â”‚   â”‚   â””â”€â”€ useImageManager.ts
â”‚   â”œâ”€â”€ layout
â”‚   â”‚   â”œâ”€â”€ DashboardLayout.tsx
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ project
â”‚   â”‚   â”œâ”€â”€ collaborators-list.tsx
â”‚   â”‚   â”œâ”€â”€ edit-project-form.tsx
â”‚   â”‚   â”œâ”€â”€ editable-due-date.tsx
â”‚   â”‚   â”œâ”€â”€ export-progress.tsx
â”‚   â”‚   â”œâ”€â”€ export-project-modal.tsx
â”‚   â”‚   â”œâ”€â”€ invite-user-modal.tsx
â”‚   â”‚   â”œâ”€â”€ permission-request-modal.tsx
â”‚   â”‚   â”œâ”€â”€ project-logs.tsx
â”‚   â”‚   â”œâ”€â”€ theme-preview-modal.tsx
â”‚   â”‚   â”œâ”€â”€ user-role-display.tsx
â”‚   â”‚   â””â”€â”€ visual-editor-modal.tsx
â”‚   â”œâ”€â”€ ui
â”‚   â”‚   â”œâ”€â”€ animated-progress-bar.tsx
â”‚   â”‚   â”œâ”€â”€ annotation-popup-editor.tsx
â”‚   â”‚   â”œâ”€â”€ badge.tsx
â”‚   â”‚   â”œâ”€â”€ bulk-file-upload.tsx
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”œâ”€â”€ checkbox.tsx
â”‚   â”‚   â”œâ”€â”€ color-picker.tsx
â”‚   â”‚   â”œâ”€â”€ confirm-dialog.tsx
â”‚   â”‚   â”œâ”€â”€ enhanced-file-upload.tsx
â”‚   â”‚   â”œâ”€â”€ export-button.tsx
â”‚   â”‚   â”œâ”€â”€ file-upload.tsx
â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”œâ”€â”€ item-detail-popup.tsx
â”‚   â”‚   â”œâ”€â”€ item-editor.tsx
â”‚   â”‚   â”œâ”€â”€ label.tsx
â”‚   â”‚   â”œâ”€â”€ notification-bell.tsx
â”‚   â”‚   â”œâ”€â”€ notification.tsx
â”‚   â”‚   â”œâ”€â”€ progress.tsx
â”‚   â”‚   â”œâ”€â”€ project-overview.tsx
â”‚   â”‚   â”œâ”€â”€ realtime-status.tsx
â”‚   â”‚   â”œâ”€â”€ screen-color-picker.tsx
â”‚   â”‚   â”œâ”€â”€ select.tsx
â”‚   â”‚   â”œâ”€â”€ textarea.tsx
â”‚   â”‚   â”œâ”€â”€ themed-badge.tsx
â”‚   â”‚   â”œâ”€â”€ themed-button.tsx
â”‚   â”‚   â”œâ”€â”€ themed-link.tsx
â”‚   â”‚   â””â”€â”€ tooltip.tsx
â”‚   â””â”€â”€ whiteboard
â”‚       â”œâ”€â”€ CoreRenderBoard.tsx
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ docs
â”‚   â”œâ”€â”€ BACKEND-SETUP-GUIDE.md
â”‚   â”œâ”€â”€ CHANGELOG-2025-11-13.md
â”‚   â”œâ”€â”€ COMPLETE-DARK-THEME-SUMMARY.md
â”‚   â”œâ”€â”€ COMPLETE-INVITATION-SETUP.sql
â”‚   â”œâ”€â”€ DESIGN-SYSTEM.md
â”‚   â”œâ”€â”€ EDIT-PROJECT-REDESIGN.md
â”‚   â”œâ”€â”€ EMAIL-INVITATIONS-ANALYSIS.md
â”‚   â”œâ”€â”€ FIX-406-COLLABORATORS-VIEW-ERROR.md
â”‚   â”œâ”€â”€ FIX-GET-USER-PROJECT.sql
â”‚   â”œâ”€â”€ FIX-GET-USER-PROJECTS-DUE-DATE.sql
â”‚   â”œâ”€â”€ FIX-INVITATION-PERMISSIONS.sql
â”‚   â”œâ”€â”€ FIX-MISSING-TABLES.sql
â”‚   â”œâ”€â”€ FIX-PRODUCTION-ISSUES.sql
â”‚   â”œâ”€â”€ FIX-PROJECT-LOGS-RLS.sql
â”‚   â”œâ”€â”€ FIX-RLS-RECURSION.sql
â”‚   â”œâ”€â”€ FIX-STORAGE-POLICIES.sql
â”‚   â”œâ”€â”€ FIX-WHITEBOARD-FETCH-ERROR.md
â”‚   â”œâ”€â”€ INVITATION-EMAIL-VERIFICATION-SETUP.md
â”‚   â”œâ”€â”€ INVITATION-SYSTEM-GUIDE.md
â”‚   â”œâ”€â”€ PRODUCTION-COMPLETE-SETUP.sql
â”‚   â”œâ”€â”€ PRODUCTION-SETUP-COMPLETE.sql
â”‚   â”œâ”€â”€ PROJECT-LIBRARY-AND-PROFILES.md
â”‚   â”œâ”€â”€ QUICK-START-INVITATIONS.md
â”‚   â”œâ”€â”€ SETUP-PHOTO-STORAGE.sql
â”‚   â”œâ”€â”€ SETUP-TEAMS.md
â”‚   â”œâ”€â”€ STYLEGUIDE-OVERVIEW.md
â”‚   â”œâ”€â”€ TEAM-BASED-THEMING.md
â”‚   â”œâ”€â”€ VERCEL-ENV-SETUP.md
â”‚   â”œâ”€â”€ WHITEBOARD-SETUP.md
â”‚   â”œâ”€â”€ add-default-due-date-setting-safe.sql
â”‚   â”œâ”€â”€ add-default-due-date-setting.sql
â”‚   â”œâ”€â”€ add-profile-images-and-due-dates.sql
â”‚   â”œâ”€â”€ check-invitations-table.sql
â”‚   â”œâ”€â”€ complete-project-history-log.md
â”‚   â”œâ”€â”€ complete-user-profiles-setup.sql
â”‚   â”œâ”€â”€ create-project-boards-table.sql
â”‚   â”œâ”€â”€ design-tokens.json
â”‚   â”œâ”€â”€ development-session-log-august-12-2024.md
â”‚   â”œâ”€â”€ email-setup.md
â”‚   â”œâ”€â”€ file-upload-color-picker.md
â”‚   â”œâ”€â”€ fix-ambiguous-column-references.sql
â”‚   â”œâ”€â”€ fix-board-function-permissions.sql
â”‚   â”œâ”€â”€ fix-collaboration-schema.sql
â”‚   â”œâ”€â”€ fix-database-issues.sql
â”‚   â”œâ”€â”€ fix-email-mismatch-function.sql
â”‚   â”œâ”€â”€ fix-invitation-flow.sql
â”‚   â”œâ”€â”€ fix-invitations-schema.sql
â”‚   â”œâ”€â”€ fix-project-collaborators-view.sql
â”‚   â”œâ”€â”€ fix-projects-rls-policies.sql
â”‚   â”œâ”€â”€ fix-projects-table-schema.sql
â”‚   â”œâ”€â”€ fix-rls-infinite-recursion.sql
â”‚   â”œâ”€â”€ fix-security-warnings-v2.sql
â”‚   â”œâ”€â”€ fix-security-warnings.sql
â”‚   â”œâ”€â”€ fix-update-user-project-rpc-remove-logo.sql
â”‚   â”œâ”€â”€ instructions.mdc
â”‚   â”œâ”€â”€ migrate-default-due-dates.sql
â”‚   â”œâ”€â”€ project-collaboration-schema.sql
â”‚   â”œâ”€â”€ project-restore.md
â”‚   â”œâ”€â”€ realtime-collaboration.md
â”‚   â”œâ”€â”€ setup-board-assets-storage.sql
â”‚   â”œâ”€â”€ setup-user-profiles.sql
â”‚   â”œâ”€â”€ test-board-function.sql
â”‚   â”œâ”€â”€ test-update-function.sql
â”‚   â”œâ”€â”€ update-project-access-control-fixed.sql
â”‚   â”œâ”€â”€ update-project-access-control.sql
â”‚   â”œâ”€â”€ update-project-rpc-with-due-date.sql
â”‚   â”œâ”€â”€ verify-and-fix-schema.sql
â”‚   â”œâ”€â”€ verify-collaborators-function.sql
â”‚   â”œâ”€â”€ verify-project-boards-setup.sql
â”‚   â””â”€â”€ verify-projects-rls.sql
â”œâ”€â”€ env.example
â”œâ”€â”€ env.production.example
â”œâ”€â”€ hooks
â”‚   â”œâ”€â”€ useNotifications.ts
â”‚   â”œâ”€â”€ usePowerPointExport.ts
â”‚   â”œâ”€â”€ useProject.ts
â”‚   â”œâ”€â”€ useProjectBoard.ts
â”‚   â”œâ”€â”€ useProjectCollaboration.ts
â”‚   â”œâ”€â”€ useRealtimeNotifications.ts
â”‚   â”œâ”€â”€ useRealtimeProject.ts
â”‚   â””â”€â”€ useSupabaseFileUpload.ts
â”œâ”€â”€ lib
â”‚   â”œâ”€â”€ auth-context.tsx
â”‚   â”œâ”€â”€ board-asset-store.ts
â”‚   â”œâ”€â”€ date-utils.ts
â”‚   â”œâ”€â”€ html-presentation-generator.ts
â”‚   â”œâ”€â”€ presentation-themes.ts
â”‚   â”œâ”€â”€ supaAdmin.ts
â”‚   â”œâ”€â”€ supaClient.ts
â”‚   â”œâ”€â”€ theme-context.tsx
â”‚   â”œâ”€â”€ user-settings.ts
â”‚   â”œâ”€â”€ utils.ts
â”‚   â”œâ”€â”€ visual-editor-html-generator.ts
â”‚   â””â”€â”€ whiteboard-html-generator.ts
â”œâ”€â”€ next-env.d.ts
â”œâ”€â”€ next.config.js
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ public
â”‚   â””â”€â”€ template-assets
â”‚       â”œâ”€â”€ css
â”‚       â””â”€â”€ images
â”œâ”€â”€ scripts
â”‚   â”œâ”€â”€ check-collaborator-permissions.js
â”‚   â”œâ”€â”€ debug-permission-issue.js
â”‚   â”œâ”€â”€ fix-update-function.js
â”‚   â”œâ”€â”€ setup-storage.js
â”‚   â”œâ”€â”€ setup-update-function.js
â”‚   â”œâ”€â”€ test-rpc-function.js
â”‚   â”œâ”€â”€ test-upload.js
â”‚   â”œâ”€â”€ update-email-mismatch-function.js
â”‚   â”œâ”€â”€ update-function-improved.js
â”‚   â””â”€â”€ verify-user-email.js
â”œâ”€â”€ supabase
â”‚   â””â”€â”€ functions
â”‚       â””â”€â”€ send-project-invitation
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ tests
â”‚   â”œâ”€â”€ example.test.ts
â”‚   â””â”€â”€ setup.ts
â”œâ”€â”€ tldraw-sync-server
â”‚   â”œâ”€â”€ README.md
â”‚   â””â”€â”€ wrangler.toml.example
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tsconfig.tsbuildinfo
â”œâ”€â”€ types
â”‚   â”œâ”€â”€ index.ts
â”‚   â””â”€â”€ schemas.ts
â””â”€â”€ vitest.config.ts

52 directories, 206 files
```

*Note: Generated with `tree -L3` excluding `node_modules`, `.git`, and `.next` directories*

### Data Flow
1. **Form Creation**: Multi-step form with validation
2. **Data Storage**: Supabase PostgreSQL with structured JSON
3. **File Uploads**: Supabase Storage with organized buckets
4. **Real-time Updates**: Supabase real-time subscriptions
5. **API Integration**: RESTful endpoints for CRUD operations

## Features

### MVP Features âœ…
- [x] Multi-step project creation form
- [x] Project dashboard with listing
- [x] Individual project view (read-only)
- [x] Supabase integration (auth + database + storage)
- [x] Form validation with Zod
- [x] Responsive UI with shadcn/ui
- [x] TypeScript throughout
- [x] Testing setup with Vitest
- [x] Code quality tools (ESLint, Prettier, Husky)

### Form Steps
1. **Project Details**: Title, retailer information
2. **Items**: Add items to render with hero images
3. **Parts**: Configure parts for each item (finish, color, texture, files)
4. **Review**: Final review and submission

## Local Development

### Prerequisites
- Node.js 18+ 
- pnpm (recommended) or npm
- Supabase account and project

### Setup Instructions

1. **Clone and Install**
   ```bash
   git clone <repository-url>
   cd core-render-portal
   pnpm install
   ```

2. **Environment Configuration**
   ```bash
   cp env.example .env.local
   ```
   
   Add your Supabase credentials to `.env.local`:
   ```env
   NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
   SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key
   ```

3. **Database Setup**
   
   Create the following table in your Supabase project:
   ```sql
   CREATE TABLE projects (
     id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
     title TEXT NOT NULL,
     retailer TEXT NOT NULL,
     items JSONB DEFAULT '[]',
     created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
     updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
   );
   
   -- Enable Row Level Security (optional)
   ALTER TABLE projects ENABLE ROW LEVEL SECURITY;
   ```

4. **Start Development Server**
   ```bash
   pnpm dev
   ```
   
   Visit http://localhost:3000

### Available Scripts
- `pnpm dev` - Start development server
- `pnpm build` - Build for production
- `pnpm start` - Start production server
- `pnpm lint` - Run ESLint
- `pnpm lint:fix` - Fix ESLint errors
- `pnpm format` - Format code with Prettier
- `pnpm test` - Run tests
- `pnpm test:ui` - Run tests with UI
- `pnpm test:coverage` - Run tests with coverage

## Database Schema

### Projects Table
```sql
CREATE TABLE projects (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  title TEXT NOT NULL,
  retailer TEXT NOT NULL,
  items JSONB DEFAULT '[]',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### JSON Structure for Items
```json
{
  "items": [
    {
      "id": "uuid",
      "name": "Item Name",
      "hero_image": "https://example.com/image.jpg",
      "parts": [
        {
          "id": "uuid",
          "name": "Part Name",
          "finish": "Matte",
          "color": "Red",
          "texture": "Smooth",
          "files": ["file1.jpg", "file2.jpg"]
        }
      ]
    }
  ]
}
```

## API Endpoints

### POST /api/project
Creates a new project with validated data.

**Request Body:**
```json
{
  "title": "Project Title",
  "retailer": "Retailer Name",
  "items": [...]
}
```

**Response:**
```json
{
  "id": "uuid",
  "title": "Project Title",
  "retailer": "Retailer Name",
  "items": [...],
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

## Testing

### Running Tests
```bash
# Run all tests
pnpm test

# Run tests with UI
pnpm test:ui

# Run tests with coverage
pnpm test:coverage
```

### Test Structure
- **Unit Tests**: Component and utility function tests
- **Integration Tests**: API route and database interaction tests
- **Schema Tests**: Zod validation tests

## Code Quality

### Pre-commit Hooks
Husky automatically runs:
- ESLint with auto-fix
- Prettier formatting
- Type checking

### Linting Rules
- TypeScript strict mode
- React hooks rules
- Import organization
- Consistent formatting

## Future Backlog

### Phase 2 Features ðŸš§
- [ ] User authentication and authorization
- [ ] File upload functionality with drag & drop
- [ ] Project status tracking (draft, in-progress, completed)
- [ ] Comments and collaboration features
- [ ] Export functionality (PDF, CSV)
- [ ] Advanced filtering and search
- [ ] Real-time notifications
- [ ] Project templates and cloning

### Phase 3 Features ðŸ“‹
- [ ] Integration with 3D rendering services
- [ ] Automated render queue management
- [ ] Cost estimation and billing
- [ ] Client portal for external access
- [ ] Advanced analytics and reporting
- [ ] Mobile-responsive PWA
- [ ] Multi-language support
- [ ] Advanced project workflows

### Technical Improvements
- [ ] Performance optimization (React Query, SWR)
- [ ] Advanced caching strategies
- [ ] Error boundary implementation
- [ ] Accessibility improvements (WCAG 2.1)
- [ ] SEO optimization
- [ ] Progressive Web App features
- [ ] Advanced testing (E2E with Playwright)

## Contributing

### Development Workflow
1. Create feature branch from `main`
2. Implement changes with tests
3. Run linting and formatting
4. Submit pull request
5. Code review and merge

### Code Standards
- Follow TypeScript strict mode
- Use functional components with hooks
- Implement proper error handling
- Write comprehensive tests
- Document complex functions
- Follow naming conventions

## Deployment

### Production Build
```bash
pnpm build
pnpm start
```

### Environment Variables
Ensure all required environment variables are set in production:
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `SUPABASE_SERVICE_ROLE_KEY`
- `NEXT_PUBLIC_APP_URL`

### Recommended Hosting
- Vercel (recommended for Next.js)
- Netlify
- Railway
- AWS/GCP with custom setup

## Support

For questions or issues:
1. Check existing documentation
2. Review test cases for examples
3. Create issue with detailed description
4. Contact development team

---

*Last updated: January 2024*
description:
globs:
alwaysApply: false
---
